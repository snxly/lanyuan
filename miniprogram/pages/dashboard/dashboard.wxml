<!--pages/dashboard/dashboard.wxml-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="header-title">ä¾›æš–ç¼´è´¹æ•°æ®çœ‹æ¿</view>
    <view class="header-subtitle">å®æ—¶ç›‘æ§ç¼´è´¹è¿›åº¦ä¸è¶‹åŠ¿ï¼Œç›®æ ‡å¼€é€šä¾›æš–éœ€è¾¾åˆ°2000æˆ·</view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- æ•°æ®å¡ç‰‡ -->
  <view wx:else class="stats-cards">
    <!-- å½“å‰ç¼´è´¹æ€»æˆ·æ•° -->
    <view class="card card-primary">
      <view class="card-title">
        <text class="card-icon">ğŸ‘¥</text>
        å½“å‰ç¼´è´¹æ€»æˆ·æ•°
      </view>
      <view class="card-value">{{formatNumber(dashboardData.totalHouseholds)}}æˆ·</view>
      <view class="card-target">
        <text>ç›®æ ‡: 2,000æˆ·</text>
        <view class="badge badge-progress">
          {{getProgressPercent()}}%
        </view>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{getProgressPercent()}}%"></view>
      </view>
    </view>

    <!-- å•æ—¥å¢é•¿æˆ·æ•° -->
    <view class="card">
      <view class="card-title">
        <text class="card-icon">ğŸ“ˆ</text>
        å•æ—¥å¢é•¿æˆ·æ•°
      </view>
      <view class="card-value">
        {{dashboardData.dailyGrowth}}æˆ·
        <view class="badge badge-success" wx:if="{{dashboardData.dailyGrowth > 0}}">+{{getDailyGrowthPercent()}}%</view>
        <view class="badge badge-warning" wx:else>-{{getDailyGrowthPercent()}}%</view>
      </view>
    </view>

    <!-- ç¼´è´¹æ€»é‡‘é¢ -->
    <view class="card">
      <view class="card-title">
        <text class="card-icon">ğŸ’°</text>
        ç¼´è´¹æ€»é‡‘é¢
      </view>
      <view class="card-value">Â¥{{formatAmount(dashboardData.totalAmount)}}</view>
    </view>

    <!-- ç¼´è´¹æœ€å¤šçš„ä¸€å¤© -->
    <view class="card">
      <view class="card-title">
        <text class="card-icon">ğŸ“…</text>
        ç¼´è´¹æœ€å¤šçš„ä¸€å¤©
      </view>
      <view class="card-value">
        {{formatDate(dashboardData.maxDay.date)}}
        <view class="badge badge-success">+{{dashboardData.maxDay.count}}æˆ·</view>
      </view>
    </view>

    <!-- ç¼´è´¹æœ€å°‘çš„ä¸€å¤© -->
    <view class="card">
      <view class="card-title">
        <text class="card-icon">ğŸ“…</text>
        ç¼´è´¹æœ€å°‘çš„ä¸€å¤©
      </view>
      <view class="card-value">
        {{formatDate(dashboardData.minDay.date)}}
        <view class="badge badge-warning">+{{dashboardData.minDay.count}}æˆ·</view>
      </view>
    </view>
  </view>

  <!-- è¶‹åŠ¿å›¾1 -->
  <view class="chart-container">
    <view class="chart-title">
      <text>ç¼´è´¹æ€»æˆ·æ•°è¶‹åŠ¿</text>
      <view class="filter-btn">
        è¿‘90å¤© <text class="filter-icon">â–¼</text>
      </view>
    </view>
    <view class="chart-placeholder">
      <text>è¶‹åŠ¿å›¾åŒºåŸŸ</text>
      <text class="chart-hint">(å¾®ä¿¡å°ç¨‹åºä¸­å¯ä½¿ç”¨echarts-for-weixinç»„ä»¶)</text>
    </view>
  </view>

  <!-- è¶‹åŠ¿å›¾2 -->
  <view class="chart-container">
    <view class="chart-title">
      <text>æ¯æ—¥ç¼´è´¹æˆ·æ•°è¶‹åŠ¿</text>
      <view class="filter-btn">
        è¿‘30å¤© <text class="filter-icon">â–¼</text>
      </view>
    </view>
    <view class="chart-placeholder">
      <text>è¶‹åŠ¿å›¾åŒºåŸŸ</text>
      <text class="chart-hint">(å¾®ä¿¡å°ç¨‹åºä¸­å¯ä½¿ç”¨echarts-for-weixinç»„ä»¶)</text>
    </view>
  </view>

  <!-- æ•°æ®åˆ—è¡¨ -->
  <view class="data-table">
    <view class="table-title">
      <text>æœ€è¿‘ç¼´è´¹è®°å½•</text>
      <view class="view-all" bindtap="viewAllRecords">
        æŸ¥çœ‹å…¨éƒ¨ <text class="arrow">â€º</text>
      </view>
    </view>
    <view class="table-header">
      <view>ç¼´è´¹æ—¶é—´</view>
      <view>ç¼´è´¹é‡‘é¢</view>
    </view>
    <view wx:for="{{dashboardData.recentPayments}}" wx:key="index" class="table-row">
      <view>
        {{item.date}}
        <view class="time-badge today" wx:if="{{isToday(item.date)}}">ä»Šå¤©</view>
      </view>
      <view class="amount">Â¥{{item.amount.toFixed(0)}}</view>
    </view>
  </view>
</view>